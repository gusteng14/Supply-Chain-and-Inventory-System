<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>User Management</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

        <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!-- FONT -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Archivo+Narrow:ital,wght@0,400..700;1,400..700&family=Archivo:ital,wght@0,100..900;1,100..900&family=Cherry+Bomb+One&family=DynaPuff:wght@400..700&family=Modak&display=swap" rel="stylesheet">

    <!-- MATERIAL ICON -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Round">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!-- CSS -->
    <link href="https://cdn.datatables.net/v/dt/dt-2.3.2/datatables.min.css" rel="stylesheet" integrity="sha384-d76uxpdVr9QyCSR9vVSYdOAZeRzNUN8A4JVqUHBVXyGxZ+oOfrZVHC/1Y58mhyNg" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" th:href="@{/css/materialize.css}"  media="screen,projection"/>
    <link rel="stylesheet" th:href="@{/css/styles.css}">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/2.3.2/js/dataTables.js" integrity="sha384-YDIK5P2Wq/2RyB+U8Zt970p1L/fEftZwbF3e22rV/bPMW+m8z+JjycMAr96s7LAz" crossorigin="anonymous"></script>

</head>

<body>
        <div class="grid-container">
            <header class="header" th:replace="~{fragments :: header-main}"></header>
            <aside th:replace="~{fragments :: sidebar}"></aside>

            <main class="main-container">
                <div class="row">
                    <div class="col s12">
                        <h4 class="page-header">Users</h4>
                        <ul sec:authorize="hasAuthority('CREATE_USER_PERM')" class="tabs">
                            <li class="tab col s3 l6"><a id="view-users" href="#view-staff-tab">View Users</a></li>
                            <li class="tab col s3 l6"><a href="#create-staff-tab">Create User Account</a></li>
                        </ul>

                        <div sec:authorize="hasAuthority('CREATE_USER_PERM')" class="row"></div>

                        <div id="view-staff-tab">
                            <table id="userTable" class="z-depth-1 display table-csis">
                                <thead style="background-color: rgba(234,233,233,0.5);">
                                    <tr class="tr-csis">
                                        <th class="dt-head-left th-csis">Employee No</th>
                                        <th class="dt-head-left th-csis">Full Name</th>
                                        <th class="dt-head-left th-csis">Contact No.</th>
                                        <th class="dt-head-left th-csis">Email</th>
                                        <th class="dt-head-left th-csis">Status</th>
                                        <th class="dt-head-left th-csis">Role</th>
                                        <th class="dt-head-right th-csis" data-dt-order="disable">
                                            <a id="logs" class="modal-trigger" href="#auditsModal">
                                                <i style="color: #9d9d9d; cursor: pointer;" class="material-icons-round prefix soft-delete">history</i>
                                            </a>
                                            <a class="modal-trigger" href="#softDeleteModal">
                                                <i style="color: #9d9d9d; cursor: pointer;" class="material-icons-round prefix soft-delete">delete</i>
                                            </a>

                                            <div style="border-radius: 10px; width: 1200px; height: auto;" id="softDeleteModal" class="modal">
                                                <div class="modal-content">
                                                    <div class="row">
                                                        <div class="col l12">
                                                            <span style="text-align: left; font-size: 28px;" class="left">Deleted User Records</span>
                                                            <span class="right">
                                                        <a id="closeSoftDeleteModal" class="modal-close btn-flat" >
                                                          <i style="color: #9d9d9d; cursor: pointer;" class="material-icons-round prefix soft-delete">close</i>
                                                        </a>
                                                    </span>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <table id="softDeleteTable" class="z-depth-1 display table-csis">
                                                            <thead>
                                                            <tr class="tr-csis">
                                                                <th class="dt-head-center th-csis">Employee No</th>
                                                                <th class="dt-head-center th-csis">Full Name</th>
                                                                <th class="dt-head-center th-csis">Contact No</th>
                                                                <th class="dt-head-center th-csis">Email</th>
                                                                <th class="dt-head-center th-csis">Status</th>
                                                                <th class="dt-head-center th-csis">Role</th>
                                                                <th class="dt-head-right th-csis" data-dt-order="disable"></th>
                                                            </tr>
                                                            </thead>
                                                            <tr th:each="deletedFields : ${deletedFields}">
                                                                <td style="font-weight: 100;" class="dt-body-left td-csis" th:text="${deletedFields.empNo}">z</td>
                                                                <td style="font-weight: 100;" class="dt-body-center td-csis" th:text="${deletedFields.getFullName()}">z</td>
                                                                <td style="font-weight: 100;" class="dt-body-center td-csis" th:text="${deletedFields.contactNo}">z</td>
                                                                <td style="font-weight: 100;" class="dt-body-center td-csis" th:text="${deletedFields.email}">z</td>
                                                                <td style="font-weight: 100;" class="dt-body-center td-csis" >
                                                                    <p th:if="${deletedFields.enabled == true}">Enabled</p>
                                                                    <p th:unless="${deletedFields.enabled}">Disabled</p>
                                                                </td>
                                                                <td style="font-weight: 100;" class="dt-body-center td-csis">
                                                                    <th:block th:each="role : ${deletedFields.roles}">
                                                                        <th:block th:text="${role.getName()}"></th:block>
                                                                        <br>
                                                                    </th:block>
                                                                </td>
                                                                <td style="font-weight: 100;" class="dt-body-right td-csis">
                                                                    <a sec:authorize="hasAuthority('DELETE_PRODUCT_PERM')" class="waves-effect waves-light btn-small crud" th:href="@{'/employee/restore/' + ${deletedFields.id}}" onclick="return confirm('Are you sure you want to restore this record??')">
                                                                        Restore
                                                                    </a>
                                                                    <a sec:authorize="hasAuthority('DELETE_PRODUCT_PERM')" class="waves-effect waves-light btn-small red lighten-1 crud" th:href="@{'/employee/delete/' + ${deletedFields.id}}" onclick="return confirm('Are you sure you want to PERMANENTLY DELETE this record?')">
                                                                        Delete
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>

                                            <div style="border-radius: 10px; width: 1200px; height: auto;" id="auditsModal" class="modal">
                                                <div class="modal-content">
                                                    <div class="row">
                                                        <div class="col l12">
                                                            <span style="text-align: left; font-size: 28px;" class="left">Logs</span>
                                                            <span class="right">
                                                        <a id="closeAuditsModal" class="modal-close btn-flat" >
                                                          <i style="color: #9d9d9d; cursor: pointer;" class="material-icons-round prefix soft-delete">close</i>
                                                        </a>
                                                    </span>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <table id="auditTable" class="z-depth-1 display table-csis">
                                                            <thead>
                                                            <th class="dt-head-left th-csis"></th>
                                                            <th class="dt-head-center th-csis">Action</th>
                                                            <th style="text-align: center;" class="dt-head-left th-csis">Date</th>
                                                            <th style="text-align: center;" class="dt-head-left th-csis">Employee No</th>
                                                            <th style="text-align: center;" class="dt-head-left th-csis">Full Name</th>
                                                            <th style="text-align: center;" class="dt-head-left th-csis">Performed by</th>
                                                            </thead>
                                                            <tr th:each="audit : ${audits}">
                                                                <td style="font-weight: 100;" th:text="${audit.revId}"></td>
                                                                <td class="action-col" style="font-weight: 100; text-align: center;" th:switch="${audit.action}">
                                                                        <span th:case="'ADD'" class="action-val-add" th:text="${audit.action}"></span>
                                                                        <span th:case="'MOD'" class="action-val-mod" th:text="${audit.action}"></span>
                                                                        <span th:case="'DEL'" class="action-val-del" th:text="${audit.action}"></span>
                                                                </td>
                                                                <td style="font-weight: 100; text-align: center;" th:text="${audit.date}"></td>
                                                                <td style="font-weight: 100; text-align: center;" th:text="${audit.empNo}"></td>
                                                                <td style="font-weight: 100; text-align: center;" th:text="${audit.fullName}"></td>
                                                                <td style="font-weight: 100; text-align: center;" th:text="${audit.username}"></td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="tr-csis-body" th:each="user : ${user}"> <!--th:if="${user.enabled}">-->
                                        <td class="dt-body-left td-csis" th:text="${user.empNo}">z</td>
                                        <td class="dt-body-left td-csis" th:text="${user.getFullName()}">z</td>
                                        <td class="dt-body-left td-csis" th:text="${user.contactNo}">z</td>
                                        <td class="dt-body-left td-csis" th:text="${user.email}">z</td>
                                        <td class="dt-body-left td-csis">
                                            <p th:if="${user.enabled == true}"> Enabled </p>
                                            <p th:unless="${user.enabled}"> Disabled </p>
                                        </td>
                                        <td class="dt-body-left td-csis" th:each="userRole : ${user.roles}" th:text="${userRole.getName()}"> </td>
<!--                                            <td th:text="${user.roles}">z</td>-->

                                        <td class="dt-body-left td-csis" th:value="${user.id}">
                                            <div class="right">
                                                <a sec:authorize="hasAuthority('READ_USER_PERM')" class="waves-effect waves-light btn-small crud" th:href="@{'/employee/' + ${user.id}}">
                                                    View
                                                </a>
                                                <a sec:authorize="hasAuthority('UPDATE_USER_PERM')" class="waves-effect waves-light btn-small blue darken-1 crud" th:href="@{/employee/edit(id=${user.id})}">
                                                    Update
                                                </a>
                                                <a sec:authorize="hasAuthority('DELETE_USER_PERM')" class="waves-effect waves-light btn-small red lighten-1 crud" th:href="@{'/employee/softdelete/' + ${user.id}}" onclick="return confirm('Are you sure you want to delete?')">
                                                    Delete
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="row"></div>

                        <div sec:authorize="hasAuthority('CREATE_USER_PERM')" id="create-staff-tab">
                            <div class="col l2"></div>

                            <form style="border-radius: 30px; padding: 30px;" class="col s12 l8 z-depth-1" id="registerForm" action="#"
                                  th:action="@{/api/v1/registration/test}" method="post" th:object="${registrationRequest}">
                                <h5>User Details Setup</h5>
                                <div class="row">
                                    <div class="input-field col s6">
                                        <i class="material-icons-round prefix">badge</i>
                                        <input style="color: black;" th:field="*{firstName}" id="first_name" type="text" required>
                                        <label for="first_name">First Name</label>
                                    </div>
                                    <div class="input-field col s6">
                                        <i class="material-icons-round prefix">badge</i>
                                        <input style="color: black;" th:field="*{middleName}" id="middle_name" type="text" required>
                                        <label for="middle_name">Middle Name</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="input-field col s6">
                                        <i class="material-icons-round prefix">badge</i>
                                        <input style="color: black;" th:field="*{lastName}" id="last_name" type="text" required>
                                        <label for="last_name">Last Name</label>
                                    </div>
                                    <div class="input-field col s6">
                                        <i class="material-icons-round prefix">phone</i>
                                        <input style="color: black;" th:field="*{contactNo}" id="contact_no" type="text" required>
                                        <label for="contact_no">Contact No</label>
                                        <p id="contactNo-message"></p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="input-field col s6">
                                        <i class="material-icons-round prefix">account_circle</i>
                                        <input style="color: black;" th:field="*{username}" id="username" type="text" required>
                                        <label for="username">Username</label>
                                        <p id="usernameError">&nbsp;</p>
                                    </div>
                                    <div class="input-field col s6">
                                        <i class="material-icons-round prefix">alternate_email</i>
                                        <input style="color: black;" th:field="*{email}" id="email" type="email" required>
                                        <label for="email">Email</label>
                                        <p id="emailError">&nbsp;</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="input-field col s6 password-container">
                                        <i class="material-icons-round prefix">lock</i>
                                        <input style="color: black;" th:field="*{password}" id="password" type="password" required>
                                        <label for="password">Password</label>
                                        <span id="show-password"><i class="material-icons-round show-password-icon">visibility_off</i></span>
                                    </div>
                                    <div class="input-field col s6 password-container">
                                        <i class="material-icons-round prefix">lock</i>
                                        <input style="color: black;"  id="confirm-password" type="password" required>
                                        <label for="confirm-password">Confirm Password</label>
                                        <span id="show-confirm-password"><i class="material-icons-round show-confirm-password-icon">visibility_off</i></span>
                                        <p id="password-message"> &nbsp;</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="input-field col s6">
                                        <i class="material-icons-round prefix">manage_accounts</i>
                                        <select th:field="*{roleRequest}" id="role" name="role" required>
<!--                                            <option value="" disabled selected>Choose your option</option>-->
                                            <option th:each="role : ${role}" th:text="${role.name}" th:value="${role.name}"
                                                    th:if="${role.name} != 'System Admin'"
                                                    th:remove="${role.name} == 'Super Admin' and (${#authentication.principal.getRole()} != 'System Admin' and
                                                     ${#authentication.principal.getRole()} != 'Super Admin') ? all : none" ></option>
                                        </select>
                                        <label>Role</label>
                                    </div>
                                </div>
                                <button id="submit" type="submit" class="btn btn-primary">Submit</button>

                            </form>
                            <div class="col l2"></div>
                        </div>
                    </div>
                    <button style="display: none;"  id="success-modal-trigger" type="button" data-target="success-modal" class="btn modal-trigger">Close</button>
                    <div style="border-radius: 10px; width: 500px;" id="success-modal" class="modal">
                        <div class="row modal-content valign-wrapper" style="margin: 0px;">
                            <div class="col l3">
                                <img style="height:auto; width: 100px;" th:src="@{../images/success-check.png}">
                            </div>
                            <div class="col l9">
                                <h6>User created successfully.</h6>
                            </div>
                        </div>
                        <div style="margin: 0px;" class="row modal-footer teal">
                            <button id="success-close" type="button" style="text-align: center; color: white;" class="modal-close waves-effect waves-green btn-flat center-align col l12" >Close</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        <script type="text/javascript" th:src="@{js/materialize.min.js}"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/2.3.2/js/dataTables.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/3.2.3/js/dataTables.buttons.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/3.2.3/js/buttons.dataTables.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/3.2.3/js/buttons.html5.min.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/3.2.3/js/buttons.print.min.js"></script>
        <script type="text/javascript" th:src="@{js/employee.js}"></script>



        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var elems = document.querySelectorAll('.sidenav');
                var instances = M.Sidenav.init(elems);
            });

            $(document).ready(function () {
                $('.sidenav').sidenav();
                $('.tabs').tabs();
                $('.modal').modal();
                $('select').formSelect();
                $('.collapsible').collapsible();
                $('.dt-button').addClass("btn");


                $('#show-password').on('click', function() {
                    var x = $('#password').attr('type');
                    if(x == "password") {
                        $('#password').attr('type', 'text');
                        $('.show-password-icon').text("visibility");
                    } else {
                        $('#password').attr('type', 'password');
                        $('.show-password-icon').text("visibility_off");
                    }
                })

                $('#show-confirm-password').on('click', function() {
                    var x = $('#confirm-password').attr('type');
                    if(x == "password") {
                        $('#confirm-password').attr('type', 'text');
                        $('.show-confirm-password-icon').text("visibility");
                    } else {
                        $('#confirm-password').attr('type', 'password');
                        $('.show-confirm-password-icon').text("visibility_off");
                    }
                })
            });
        </script>

</body>

</html>
